[{"title": "Limited Security Token Assessment", "repos": 2, "type": "Token", "start_date": "2019-12-03", "end_date": "2019-12-12", "specification": ["https://github.com/tokensoft/1404_token/blob/9f13fd865febbe56d215b4220c1a2d8d37728605/README.md"], "adherence_to_specification": "The code mostly matches the comments and the `README` documentation. The major case of a mismatch was written in the finding `QSP-4 Unclear Expected Token Supply`.", "best_practices": "The code mostly adheres to the best coding practices, however, highlighted a few cases that could use improvement:\n- Use of `block.timestamp` as noted in the finding `QSP-1` - **Acknowledged**\n- Input validation is missing:\n    - `restrictions/TransferRestrictions.sol`,  `L21` (commit `16da643`): potentially, needs a check whether `_validators` is a non-zero address - **Fixed**\n    - `capabilities/Timelockable.sol`, `L31` (commit `16da643`): recommended checking that `amount` is greater than 0\n    - `capabilities/Timelockable.sol`, `L46` (commit `16da643`): recommended checking that `amountToRelease` is greater than 0\n    - `InxToken.sol`, `L51` (commit `16da643`):  recommended checking that `_newRestrictionsAddress` is a non-zero address\n- All role definitions (such as `PauserRole`, `TimelockerRole`, etc.) in the `roles` folder look similar to each other and could use refactoring. However, given the state of the project and the timeline, it could be impractical.", "code_documentation": "Most of the code is well-documented, however, there are instances that could use improvement:\n\n1. `README.md`, `L58` (commit `16da643`):  it is likely that the command to run coverage is `npm run solcover` rather than `npm run coverage`\n2. Files under the `roles` folder are missing code comments\n3. `RestrictionMessages.sol`, `L11`, `Whitelistable.sol`, `L20` and `L24` (commit `16da643`), and the corresponding test files: \"white list\" should likely be \"whitelist\"\n4. `Pausable.sol`, `L22` and `L30` (commit `16da643`): \"owner\"  in `called by the owner` should likely be reworded to disambiguate from the `owner` role - **Fixed**.", "code_coverage_text": "Test coverage is fairly high and meets our expectations. While having a perfect branch coverage is not a requirement, it is recommended to inspect the uncovered branches and consider adding tests if these cases are deemed to be significant.", "code_coverage_data": "-------------------------------|----------|----------|----------|----------|----------------|\nFile                           |  % Stmts | % Branch |  % Funcs |  % Lines |Uncovered Lines |\n-------------------------------|----------|----------|----------|----------|----------------|\n contracts/                    |      100 |      100 |      100 |      100 |                |\n  InxToken.sol                 |      100 |      100 |      100 |      100 |                |\n contracts/1404/               |      100 |      100 |      100 |      100 |                |\n  IERC1404.sol                 |      100 |      100 |      100 |      100 |                |\n  IERC1404Validators.sol       |      100 |      100 |      100 |      100 |                |\n contracts/capabilities/       |      100 |    78.57 |      100 |      100 |                |\n  Pausable.sol                 |      100 |      100 |      100 |      100 |                |\n  Revocable.sol                |      100 |      100 |      100 |      100 |                |\n  Timelockable.sol             |      100 |    78.57 |      100 |      100 |                |\n  Whitelistable.sol            |      100 |      100 |      100 |      100 |                |\n contracts/restrictions/       |    95.83 |    94.44 |      100 |    95.83 |                |\n  RestrictionMessages.sol      |      100 |      100 |      100 |      100 |                |\n  TransferRestrictions.sol     |      100 |      100 |      100 |      100 |                |\n  TransferRestrictionsNone.sol |       80 |       50 |      100 |       80 |             40 |\n contracts/roles/              |      100 |    83.33 |      100 |      100 |                |\n  OwnerRole.sol                |      100 |       75 |      100 |      100 |                |\n  PauserRole.sol               |      100 |      100 |      100 |      100 |                |\n  RevokerRole.sol              |      100 |      100 |      100 |      100 |                |\n  TimelockerRole.sol           |      100 |      100 |      100 |      100 |                |\n  WhitelisterRole.sol          |      100 |       50 |      100 |      100 |                |\n-------------------------------|----------|----------|----------|----------|----------------|\nAll files                      |    99.19 |     87.5 |      100 |    99.23 |                |\n-------------------------------|----------|----------|----------|----------|----------------|", "test_suite_text": "All tests pass.", "test_suite_data": "   Contract: 1404 Restrictions\n    \u2713 should deploy\n    \u2713 should fail if TransferRestrictions are not set (106ms)\n    \u2713 should fail with non whitelisted accounts (307ms)\n    \u2713 should fail if tokens are timelocked (362ms)\n    \u2713 should fail if contract is paused (275ms)\n    \u2713 should handle unknown error codes\n\n  Contract: InxToken\n    \u2713 should deploy\n    \u2713 owner owns 200,000,000 inx\n    \u2713 should have correct details set (57ms)\n    \u2713 should mint tokens to owner (64ms)\n    \u2713 should mint tokens to different owner (53ms)\n\n  Contract: OwnerRole\n    \u2713 should deploy and set owner\n    \u2713 should allow an owner to add/remove owners (121ms)\n    \u2713 should not allow a non owner to add/remove owners (358ms)\n    \u2713 should not allow an owner to add 0x0 owner\n    \u2713 should emit events for adding owners (54ms)\n    \u2713 should emit events for removing owners (76ms)\n\n  Contract: Pausable\n    \u2713 should allow the pauser to pause/unpause (140ms)\n    \u2713 should not allow non pausers to pause/unpause (382ms)\n    \u2713 should block transfers when paused and allow transfers when unpaused (445ms)\n\n  Contract: PauserRole\n    \u2713 Owner should be able to add/remove pauser (103ms)\n    \u2713 Non owner should not be able to add/remove pauser\n    \u2713 Add pauser should fire event\n    \u2713 Remove pauser should fire event (75ms)\n\n  Contract: Revocable\n    \u2713 Revoker should be able to revoke tokens from any account (327ms)\n    \u2713 Non revokers should not be able to revoke tokens (303ms)\n    \u2713 should emit event when tokens are revoked (275ms)\n\n  Contract: RevokerRole\n    \u2713 Owner should be able to add/remove revoker (103ms)\n    \u2713 Non owner should not be able to add/remove revoker\n    \u2713 Add revoker should fire event\n    \u2713 Remove revoker should fire event (85ms)\n\n  Contract: Timelockable\n    \u2713 Owner should be able to lock/release tokens (695ms)\n    \u2713 Owner should be able to update timelocks (206ms)\n    \u2713 Owner should be able to release timelocks (183ms)\n    \u2713 Expired timelocks should not prevent transfers (3393ms)\n    \u2713 Non owners should not be able to lock/release tokens (555ms)\n    \u2713 should emit event when tokens are locked (128ms)\n    \u2713 should emit event when tokens are released (262ms)\n\n  Contract: TimelockerRole\n    \u2713 Owner should be able to add/remove timelocker (162ms)\n    \u2713 Non owner should not be able to add/remove timelocker\n    \u2713 Add timelocker should fire event (46ms)\n    \u2713 Remove timelocker should fire event (88ms)\n    \u2713 Owner should be able to add/remove whitelister (174ms)\n    \u2713 Non owner should not be able to add/remove whitelister\n    \u2713 Add whitelister should fire event (48ms)\n    \u2713 Remove whitelister should fire event (109ms)\n\n  Contract: Transfers\n    \u2713 should deploy\n    \u2713 All users should be blocked from sending to non whitelisted non role-assigned accounts (404ms)\n    \u2713 Initial transfers should fail but succeed after white listing (520ms)\n    \u2713 Initial transferFroms should fail but succeed after white listing (676ms)\n\n  Contract: Upgrade Restrictions\n    \u2713 should deploy\n    \u2713 The TransferRestrictions cannot be deployed with the _validators param of 0x0 (60ms)\n    \u2713 The TransferRestrictions address should be updateable by owners (119ms)\n    \u2713 The TransferRestrictions address should no be updateable by non owners (738ms)\n    \u2713 Restricted transfers should succeed after removing restrictions (331ms)\n    \u2713 Updating restriction should fire event (183ms)\n\n  Contract: Whitelistable\n    \u2713 Whitelister should be able to set whitelist (89ms)\n    \u2713 Only transfer between whitelisted accounts should succeed (283ms)\n\n  Contract: WhitelisterRole\n    \u2713 Owner should be able to add/remove whitelister (272ms)\n    \u2713 Non owner should not be able to add/remove whitelister\n    \u2713 Add whitelister should fire event (184ms)\n    \u2713 Remove whitelister should fire event (212ms)\n\n\n  62 passing (34s)", "published": false, "findings": [{"id": 0, "title": "Unclear Expected Locking Behaviour", "severity": "Low", "files_involved": ["capabilities/Timelockable.sol"], "description": "Repeated calls to the `lock` method override the previous locks set for the given token holder. In addition, if multiple `lock(...)` transactions are sent at the same time, a hypothetical miner holding the tokens could choose to mine the transaction that is more favorable to the miner, thus making the contract vulnerable to transaction ordering.", "exploit_scenario": "", "recommendation": "\n1. Documenting the expected behaviour when `lock` is called multiple times\n2. If the transaction ordering behaviour is undesired, consider adding `increaseLock(...)` and `decreaseLock(...)` methods\n\n**Update**: Tokensoft has acknowledged the issue and added the following comment on transaction ordering to `README.md`: \"Care should be taken not to send out multiple 'lock' transactions at once as the last transaction mined will be the values that are persisted.\"  as of commit `9f13fd8`. Tokensoft has confirmed this is expected behavior and the risk has been documented. "}, {"id": 1, "title": "Block Timestamp Manipulation", "severity": "Low", "files_involved": ["capabilities/Timelockable.sol"], "description": "Projects may rely on block timestamps for various purposes. However, it's important to realize that miners individually set the timestamp of a block, and attackers may be able to manipulate timestamps for their own purposes. If a smart contract relies on a timestamp, it must take this into account.\n\nThe locking mechanism is based on `block.timestamp`. Miners who happen to hold INX tokens could delay the release of tokens of other token holders as a means to get a trading advantage. \n", "exploit_scenario": "", "recommendation": "\n1. Changing the logic to rely on `block.number` as a means to control locking/releasing instead of `block.timestamp`\n2. Requiring large minimum locking period in order to minimize the effect of timestamp manipulation.\n\n**Update**: Tokensoft has acknowledged the use of `block.timestamp` and noted: \"The block.timestamp is used to determine if a Timelock is expired, the block.timestamp is set by miners and not guaranteed to be accurate, it can differ from the true time by as much as 15 seconds.\" in `README.md` as of commit `9f13fd8`. Tokensoft has confirmed this is expected behavior and the risk has been documented. "}, {"id": 2, "title": "Privileged Roles and Ownership", "severity": "Low", "files_involved": [""], "description": "Smart contracts will often have `owner` variables to designate the person with special privileges to make modifications to the smart contract.\n\nIn this case, the owner is capable of granting any Ethereum account (including the owner themselves) an ability to revoke tokens from an arbitrary\naccount or time-locking tokens of an arbitrary account. If an owner's private key is compromised, all users become automatically at risk.\n\nConsequently, for the purposes of this audit, we assume that the administrator and price feeds are available, honest, and not compromised.", "exploit_scenario": "", "recommendation": "While the owner privileges are documented in the `README.md` file, the centralization of power needs to be made clear to the end-users also.\n\n\n**Update**: Tokensoft has acknowledged the owner variables that designate a person with special privileges can make modifications to the smart contract. They have noted \u201cThe Owner account specified at the time of deployment will be the only owner account by default. Since Owners can assign Revoker, Timelocker, and Whitelister privileges to themselves they have the ability to unilaterally impact trading capabilities and even token balances for all users.\u201d in `README.md` as of commit `9f13fd8`. Tokensoft has confirmed this is expected behavior and the risk has been documented\n"}, {"id": 3, "title": "Unclear Expected Token Supply", "severity": "Informational", "files_involved": ["InxToken.sol"], "description": "`InxToken.sol`, `L21` (commit `16da643`): the comment says `Token supply - 2 Hundred Thousand Tokens, with 18 decimal precision`, while the constant `HUNDRED_THOUSAND` is set to `100000000`, which is one hundred million, thus making `TOKEN_SUPPLY` being two hundred million.\n", "exploit_scenario": "", "recommendation": "\n1. Documenting the expected behaviour and fixing the code comments, if applicable\n2. Making a code change to the constant, if applicable.\n\n\n**Update**: Tokensoft has adjusted variable naming as of commit `9f13fd8`. Tokensoft has documented the token supply in the README: \"On deployment, all tokens will be transferred to the owner account passed in during deployment. The total supply will be 200,000,000 tokens.\"\n"}], "total_issues": [{"severity": "Undetermined", "issues_found": 10, "issues_resolved": 11, "issues_acknowledged": 12}, {"severity": "Informational", "issues_found": 13, "issues_resolved": 14, "issues_acknowledged": 15}, {"severity": "Low", "issues_found": 1, "issues_resolved": 2, "issues_acknowledged": 3}, {"severity": "Medium", "issues_found": 4, "issues_resolved": 5, "issues_acknowledged": 6}, {"severity": "High", "issues_found": 7, "issues_resolved": 8, "issues_acknowledged": 9}]}]